---
title: "country report"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
format: pptx
execute:
  echo: FALSE
params: 
  curr_pd: "FY22Q4"
  cntry: "Malawi"
  agency: "USAID"

---

```{r}
# | label: setup
# | include: FALSE

# DEPENDENCIES ------------------------------------------------------------
  
  library(tidyverse)
  library(gagglr)
  library(glue)
  library(scales)
  library(extrafont)
  library(tidytext)
  library(patchwork)
  library(ggtext)
  library(googlesheets4)
  library(mindthegap)
  library(ggrepel)
  library(janitor)
  library(sf)
  library(selfdestructin5)
  library(gt)
  library(cascade) # Use dev version
  library(ggpattern)
  library(rcartocolor)
  library(here)
  library(assertr)

# SOURCE LOCAL FUNCTIONS --------------------------------------------------

  
  source("Scripts/01_achievement_indicator-psnu.R")
  source("Scripts/02_95s_epi.R")
  source("Scripts/03_prevalence-gaps_gp-psnu-sex.R")
  source("Scripts/04_populationpyramid.R")
  source("Scripts/05_testing.R")
  #missing #6 linkage
  source("Scripts/07_txcoverage_age_sex.R")
  source("Scripts/08_vl-coverage-and-suppression_gp-age.R")
  source("Scripts/09_vl-coverage-and-suppression_gp-psnu.R")
  source("Scripts/10_PrEP-trends_age-sex-KP.R")
  source("Scripts/11_sid_comp.R")
  source("Scripts/12_budget-trends_agency.R")
  source("Scripts/13_funding-distro_funding-flavors.R")
  source("Scripts/14_hrh-footprint-various.R")
  source("Scripts/15_10s_barriers.R")
  source("Scripts/16_hrh-titles.R")

```

## Purpose

In advance of the PLLs and COP meetings starting the week of February 13, the OHA/SIEI division wanted to provide some useful data points that may help as a launching point to these discussions and help hasten further exploration. The visuals provided here aim to provide a first step in identifying gaps and a baseline as they relate to COP priorities informed by Dr. Nkengasong's 5x3 pillars. 

These supporting visuals are intended to help create and inform initial discussion and prompt further data exploration. We have provided notes, data sources, and calculations for anything included here to make this a jumping off point to delve into any software and explore further. If you have questions, please contact your SIEI backstop for assistance.

## 1. Are there any major gaps in achievement as of `params$curr_pd`?

```{r}
# | label: achievement
  df_msd %>%
        prep_achv_psnu(params$cntry,params$agency) %>%
        viz_achv_psnu()
```  


## 2. Is progress being made in reaching epidemic control? Are there gaps in the 95s that can be targeted?

```{r}
# | label: epi_95s

viz_unaids_all(params$cntry, params$agency)

```
## 3. What does HIV prevalence look like across sex / SNUs? by age/sex bands?

```{r}
#| label: prevalence
df_natsubnat %>% 
  prep_hiv_prevalence(params$cntry) %>% 
  viz_hiv_prevalence()
  
```
## 4. Is there a youth buldge of PLHIV we need to plan for?

```{r}
# | label: youth_bulge

df_natsubnat %>% 
  prep_pop_pyramid(params$cntry) %>% 
  viz_pop_pyramid()

```

## 5. Does testing favor prevention or case finding and does this fit with where `params$cntry` is in the epidemic?

```{r}
# | label: testing

 prep_modality_age(df_msd, params$cntry, params$agency, trendscoarse) %>% 
   viz_modality_age()

```

## 6. Are there any major issues with proxy linkage by geography/population that can be targeted?

```{r}
# | label: linkage

```

## 7. Are new patients being added to the areas with the largest gaps in treatment coverage?

```{r}
# | label: tx_gap

viz_tx_all(params$cntry) #wrapper function for tx_coverage and tx_new


```

## 8. Are certain populations by age or sex being missed when trying to reach the 3rd 95?

```{r}
# | label: vlsc_pop

```

## 9. Are certain populations by age or sex being missed when trying to reach the 3rd 95?

```{r}
# | label: vlsc_geo

```

## 10. Is PrEP uptake relatively consistent across demographics?

```{r}
# | label: prep

df_msd %>%
    prep_prep_disagg(params$cntry,params$agency) %>%
    viz_prep_disagg(params$cntry,params$agency)
```

## 11. Are there key gaps identified by the SID for the country to prioritize?

```{r}
# | label: sid

df_sid %>% 
  prep_sid(params$cntry) %>% 
  viz_sid()
```
## 12. Have COP budgets been flatlining or changing in a similar manner across agencies?

```{r}
# | label: budget_share

df_fsd %>% 
  prep_budget_trends(params$cntry) %>% 
  viz_budget_trends()

```

## 13. Does the country have the optimal mix of PEPFAR spending when thinking about sustainability?

```{r}
#| label: funding_distro

df_fsd %>% 
  prep_funding_distro(params$cntry, param$agency) %>% 
  viz_funding_distro()

```

## 14. What does the current staffing footprint look like in country? How do they align with sustainability and leveraging our assets?

```{r}
#| label: staffing_footprint

df_hrh %>% 
  prep_hrh_footprint(params$cntry, param$agency) %>% 
  viz_hrh_footprint()
```

## 15. What are the gaps in adopting structural laws and policies towards the UNAIDS 10-10-10 goals?

```{r}
#| label: 10-10-10 barriers

df_tens %>% 
  prep_10s_barriers(params$cntry) %>% 
  viz_10s_barriers()
```

## 16. What are the large staffing categories? How do they align with sustainability and leveraging our assets?

```{r}
#| label: staffing_titles

df_hrh %>% 
  prep_hrh_titles(params$cntry, param$agency) %>% 
  viz_hrh_titles()
```

## Calculations Used

TODO

## Data Sources

TODO
